{% extends "base.html" %}

{% block content %}
<div class="stats-grid">
    <div class="stat-card" data-category="all">
        <div class="stat-icon icon-all">
            <i class="fa-solid fa-network-wired"></i>
        </div>
        <div class="stat-info">
            <h3>Total Active</h3>
            <p class="stat-value" id="stat-all">0</p>
        </div>
    </div>
    <div class="stat-card" data-category="safe">
        <div class="stat-icon icon-safe">
            <i class="fa-solid fa-shield-check"></i>
        </div>
        <div class="stat-info">
            <h3>Safe</h3>
            <p class="stat-value" id="stat-safe">0</p>
        </div>
    </div>
    <div class="stat-card" data-category="suspicious">
        <div class="stat-icon icon-suspicious">
            <i class="fa-solid fa-triangle-exclamation"></i>
        </div>
        <div class="stat-info">
            <h3>Suspicious</h3>
            <p class="stat-value" id="stat-suspicious">0</p>
        </div>
    </div>
    <div class="stat-card" data-category="malicious">
        <div class="stat-icon icon-malicious">
            <i class="fa-solid fa-skull-crossbones"></i>
        </div>
        <div class="stat-info">
            <h3>Malicious</h3>
            <p class="stat-value" id="stat-malicious">0</p>
        </div>
    </div>
</div>

<div class="card table-container">
    <div class="card-header">
        <h2>Active Connections</h2>
        <span class="live-badge"><span class="pulse"></span> Live</span>
    </div>
    <div class="table-responsive">
        <table class="data-table">
            <thead>
                <tr>
                    <th>IP Address</th>
                    <th>Hostname</th>
                    <th>Full Location</th>
                    <th>Risk Level</th>
                    <th>Score</th>
                    <th>Last Scanned</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="connections-table-body">
                <tr>
                    <td colspan="7" class="loading-cell">Loading connections...</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="pagination-container">
        <button class="page-btn" id="d-first-btn" onclick="changePage('first')"><i
                class="fa-solid fa-angles-left"></i></button>
        <button class="page-btn" id="d-prev-btn" onclick="changePage('prev')"><i
                class="fa-solid fa-angle-left"></i></button>
        <span id="d-page-info">Page 1 of 1</span>
        <button class="page-btn" id="d-next-btn" onclick="changePage('next')"><i
                class="fa-solid fa-angle-right"></i></button>
        <button class="page-btn" id="d-last-btn" onclick="changePage('last')"><i
                class="fa-solid fa-angles-right"></i></button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const pageTitle = document.getElementById('page-title');
        if (pageTitle) pageTitle.textContent = 'Dashboard';

        // Initial fetch
        fetchData();

        // Poll every 10 seconds (User mentioned 10 min for json update, but UI can refresh faster to feel responsive or just wait)
        // Let's stick to a reasonable polling like 30s to catch updates when they happen.
        setInterval(fetchData, 30000);
    });
</script>

<!-- Details Modal -->
<div id="details-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Connection Details</h2>
            <button class="close-modal-btn" onclick="closeModal()"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-body">
            <div class="detail-row">
                <span class="detail-label">IP Address</span>
                <span class="detail-value" id="m-ip"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Hostname</span>
                <span class="detail-value" id="m-hostname"></span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Location</span>
                <span class="detail-value" id="m-location"></span>
            </div>
            <div class="detail-grid">
                <div class="detail-box">
                    <span class="detail-label">Local IP</span>
                    <span class="detail-value" id="m-local-ip"></span>
                </div>
                 <div class="detail-box">
                    <span class="detail-label">Remote Port</span>
                    <span class="detail-value" id="m-remote-port"></span>
                </div>
                <div class="detail-box">
                    <span class="detail-label">Local Port</span>
                    <span class="detail-value" id="m-local-port"></span>
                </div>
                <div class="detail-box">
                    <span class="detail-label">Process ID (PID)</span>
                    <span class="detail-value" id="m-pid"></span>
                </div>
            </div>
            <div class="detail-row">
                <span class="detail-label">Risk Level</span>
                <span class="detail-value" id="m-risk"></span>
            </div>
             <div class="detail-row">
                <span class="detail-label">Abuse Score</span>
                <span class="detail-value" id="m-score"></span>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-back" onclick="closeModal()"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</button>
        </div>
    </div>
</div>
{% endblock %}
